<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Admin · Primer Latino</title>
  <link rel="stylesheet" href="/admin/login.css">
</head>

<body>
  <main>
    <section id="loginSection" class="login-card">
      <h1>Panel Admin</h1>
      <p class="muted">Asian Club</p>
      <form id="loginForm" autocomplete="off" onsubmit="return false;">
        <input type="email" id="email" name="email" placeholder="Correo" autocomplete="email" required>
        <input type="password" id="password" name="password" placeholder="Contraseña" autocomplete="new-password" required>
        <button id="loginBtn" type="submit" class="btn primary">Entrar</button>
        <div id="msg" aria-live="polite"></div>
      </form>
    </section>
  </main>
</body>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDHCerO4kSlT4xftQFSTFmNWqlVXrP7ytQ",
      authDomain: "asian-club-48f5f.firebaseapp.com",
      projectId: "asian-club-48f5f",
      storageBucket: "asian-club-48f5f.firebasestorage.app",
      messagingSenderId: "1091116739869",
      appId: "1:1091116739869:web:d5a43aa9be8dc8a8e205f4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const loginForm = document.getElementById('loginForm');
    const msg = document.getElementById('msg');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if (!email || !password) { msg.textContent = 'Completa los campos'; return; }
      try {
        const cred = await signInWithEmailAndPassword(auth, email, password);
        const idToken = await cred.user.getIdToken();
        const resp = await fetch('/admin/issue-token', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + idToken },
          body: JSON.stringify({})
        });
        if (resp.ok) {
          const j = await resp.json();
          if (j && j.admin_token) {
            localStorage.setItem('admin_token', j.admin_token);
            window.location.href = '/admin/add.html';
            return;
          }
        }
        msg.textContent = 'No se pudo obtener token admin';
      } catch (err) {
        console.warn('login error', err);
        msg.textContent = 'Correo o contraseña incorrecta';
      }
    });
  </script>

</html>